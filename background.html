<html>
	<head>
		<script src="js/jquery-1.4.2.min.js"></script>
		<script src="js/db.js"></script>
		<script src="js/lib.js"></script>
	</head>
	<body>
		<div id="data">
		</div>
		<script>
			DB.init();
			//listen for changes to detect activity
			chrome.windows.onFocusChanged.addListener(
				function(windowid) {
					localStorage['lastActive'] = new Date().getTime();
				});
			chrome.tabs.onSelectionChanged.addListener(
				function(tabid) {
					localStorage['lastActive'] = new Date().getTime();
				});

			function fetch_url() {
				if(Lib.isActive()) {//only update chrome was active
					chrome.tabs.getSelected(null, function(tab) {
						var d = new Date();
						var rowObj = {};
						var urlArray = tab.url.split(/\//);
						//only count http and https pages
						if(urlArray[0] == 'http:' || urlArray[0] == 'https:') {
							rowObj['host'] = urlArray[2].replace(/^www\./, '');
							var dateStr = d.toISOString().split(/T/)[0];
							rowObj['date'] = dateStr;
							rowObj['hour'] = d.getHours();
							DB.updateRow(rowObj);
						}
					});
				}
			}
			window.setInterval('fetch_url()', 10000);
		</script>
	</body>
</html>
