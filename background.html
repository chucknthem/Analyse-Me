<html>
	<head>
		<script src="js/jquery-1.4.2.min.js"></script>
		<script src="js/db.js"></script>
	</head>
	<body>
		<div id="data">
		</div>
		<script>
			function fetch_url() {
				chrome.tabs.getSelected(null, function(tab) {
					chrome.tabs.sendRequest(tab.id, {}, function(response) {
					if (response.value == 1) {
						var d = new Date();
						var rowObj = {};
						var urlArray = tab.url.split(/\//);
						//only count http and https pages
						if(urlArray[0] == 'http:' || urlArray[0] == 'https:') {
							rowObj['host'] = urlArray[2].replace(/^www\./, '');
							var dateStr = d.toISOString().split(/T/)[0];
							rowObj['date'] = dateStr;
							rowObj['hour'] = d.getHours();
							DB.updateRow(rowObj);
						}
					}
				});
			});
		}
			DB.initDB();
			window.setInterval('fetch_url()', 10000);
		</script>
	</body>
</html>
